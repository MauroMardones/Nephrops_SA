---
title: "![](../figs/IEO-logo2.png){width=8cm}"

output:
  bookdown::pdf_document2:
    latex_engine: xelatex
    includes:
      before_body: ../bib/titulo.sty
    keep_tex: yes
    number_sections: no
    toc: true
    toc_depth: 3

fontsize: 12pt
bibliography: ../bib/nephrops.bib
csl: ../bib/apa.csl

link-citations: yes
linkcolor: blue
indent: no

header-includes:
  - \usepackage{pdflscape}
  - \usepackage{fontspec}
  - \usepackage{setspace}
  - \onehalfspacing
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhf{}
  - \rhead{\footnotesize WKMSYSPiCT Benchmark \\ Februery 2026 \\ Copenhagen (Denmark)}
  - \renewcommand{\headrulewidth}{0pt}
  - \lfoot[\thepage]{}
  - \rfoot[]{\thepage}
  - \usepackage{caption}
  - \captionsetup{
      justification=raggedright,
      singlelinecheck=false,
      width=\textwidth
    }
---


```{r setup, include=FALSE, message=F}
rm(list = ls())
options(bitmapType = "cairo") 
#XQuartz is a mess, put this in your onload to default to cairo instead (https://github.com/tidyverse/ggplot2/issues/2655)
# Lo mapas se hacen mas rapido
# solo para IOs
knitr::opts_chunk$set(echo=FALSE,
                      collapse = TRUE, 
                      comment = "  ", 
                      fig.align = 'center',
                      cache=FALSE,
                      warning = FALSE,
                      # imagen en el lugar del chunk
                      message = FALSE)
```

\pagebreak

```{r echo = FALSE, message = FALSE}
library(usethis)
library(devtools)
library(ellipse)
library(spict) #comprobar esta versión de spict_v1.2.8
#library(MQMF) #Suprlus production models Malcom Haddon
library(tidyverse)
library(patchwork)
library(knitr)
library(egg) # ggarrange
library(ggthemes)
library(readxl)
library(tidyverse)
library(ggpubr)
# Paquetes necesari
library(GGally)
library(kableExtra)
library(flextable)
library(officer)
library(here)
```

## Abstract

*Nephrops* stock in FU30 Division 9.a is considered a Category 3 stock. The advice is currently based on the 2-over-3 rule using the abundance index from UWTV surveys. The reference points for this stock are undefined and ICES cannot assess the stock and exploitation status relative to MSY or precautionary approach (PA) reference points. Stochastic surplus production model in continuous time (SPiCT) has been recommended by ICES for a number of data limited stocks to produce MSY advice. This WD shows some SPiCT explorations carried out in order to evaluate the potential of this model for Nephrops FU 30 assessment and propose this stock as possible candidate for the next WKMSYSPiCT benchmark. Results obtained are promising.


\newpage

## Introduction

Nephrops stock in FU30 Division 9.a was benchmarked in October 2016 [@ICES2017WKNEP] and an approach based on UWTV surveys to generate catch options was proposed for this FU. However, reference points could not be derived according to methodologies used by Category 1 Nephrops stocks conducting UWTV surveys. Consequently, the stock was not upgraded to Category 1. Different assessment models developed for data-limited stocks (DLS), such as Length-Based Indicators (LBIs) or Mean Length–Z (MLZ) based on the WKLIFE V framework [@ICES2015], as well as the Separable Cohort Analysis (SCA; R package version 1.2.0; @Bell2019SCA) and the Separable Length Cohort Analysis (SLCA–nepref; R package version 0.2.2; @Dobby2019nepref), which are used to calculate MSY reference points for Category 1 Nephrops stocks, were explored for this stock during WKNephrops in November 2019 [@ICES2020WKNephrops]. However, MSY reference points could not be derived adequately. Therefore, Nephrops FU30 remains classified as a Category 3 stock.

The SCA method was revisited during WGBIE 2023, following an update of the UWTV survey area and the geostatistical estimation of Nephrops burrow abundance in 2022. In addition, LBI, LBSPR and MLZ methods were also applied during that working group for this stock. However, results from LBI, LBSPR and MLZ should be interpreted with caution, as not all assumptions underlying these methods are met for Nephrops stocks. Key limitations include the assumption of equilibrium conditions, such as constant total mortality and recruitment, which have also been identified in other Nephrops stocks [@CousidoRocha2022]. Furthermore, life-history parameters (M/k, L~inf~, L50, L95) are highly uncertain, as they have not been updated since the 1980s–1990s and are not specific to FU30. An additional limitation is that these approaches do not explicitly account for spatial structure, which is particularly relevant for Nephrops due to its burrow-dwelling behaviour and strong association with sediment type. Finally, length-composition data should be representative of the exploited population, but recent sampling has been inadequate, with reduced sampling intensity and incomplete quarterly coverage. Some of these considerations also apply when interpreting SCA results.

According to the 2023 ICES guidelines for providing advice on data-limited stocks [@ICES2023a], this stock should have been assessed using the `ICES rfb rule` (Method 2.1; @ICES2021SPiCT). However, given the limitations of these methods for this stock and the fishing pressure indicator (HR) accepted during the last benchmark [@ICES2017WKNEP], which provided more complete information than the indicator derived from the new rfb rule, the latter was not applied, following ACOM recommendations.

The Stochastic Surplus Production Model in Continuous Time (SPiCT) has been proposed by ICES to produce MSY advice for several Category 3 stocks in benchmark workshops conducted since 2021. The SPiCT model has already been accepted as the assessment basis for three additional Nephrops functional units in Division 9.a [@ICES2021WGBIE; @GonzalezHerraiz2023], and for one additional Nephrops FU nominated for the next WKMSYSPiCT in 2023–2024.

In addition, to revisiting the advantages and limitations of the scenarios previously tested in past working group meetings, this report extends the exploratory framework by incorporating new SPiCT scenarios that emerged from discussions held after the last meeting in December 2025. Specifically, a new set of scenarios is introduced, all configured consistently with the previous analyses by applying the same four alternative prior configurations (RUN1–RUN4) to each scenario. These new explorations include: (i) an alternative configuration incorporating all available indices simultaneously, (ii) a scenario based on a standardized index formulation, (iii) a scenario using a normalized ARSA survey time series, and (iv) a scenario in which fishing effort is included as a normalized series. The document provides a structured synthesis of these new scenarios and presents their main results, highlighting their relative performance, strengths and limitations in comparison with previously explored configurations, with the aim of informing future benchmark discussions and potential model selection for Nephrops FU30.

\newpage

## Methods

### Study Area

The Gulf of Cádiz (FU30, Division 9.a) is located in the southwestern part of the Iberian Peninsula, bordered to the north by the Portuguese coast and to the south by the Strait of Gibraltar (Figure \@ref(fig:areaconcept)). The area is characterised by a wide continental shelf that extends from the coast to depths of approximately 200 m, followed by a steep slope descending to depths exceeding 1 000 m. The seabed is predominantly composed of sandy and muddy sediments, which provide suitable habitats for Nephrops norvegicus.

### SPiCT description

Surplus productions models are widely used in fisheries stock assessment, particularly for data-limited stocks. These models describe the dynamics of the total biomass of a fish stock over time, considering the balance between growth (production) and removals (catches). The basic equation governing surplus production models is:
$$
\frac{dB(t)}{dt} = P(B(t)) - C(t)
$$
where:
- \( B(t) \) is the biomass at time \( t \),
- \( P(B(t)) \) is the surplus production function, representing the net growth of the biomass,
- \( C(t) \) is the catch at time \( t \).

In a graphical  inspection, a surplus production curve typically has a dome-shaped form, indicating that production increases with biomass up to a certain point (the maximum sustainable yield, MSY), after which it declines due to density-dependent effects. The shape of curve dependes on the specific functional form chosen for \( P(B) \), such as the Schaefer model, Pella-Tomlinson model, or others. (Figure \@ref(fig:surplusplot)).

The SPiCT model extends traditional surplus production models by incorporating stochastic elements and continuous-time dynamics. This allows for a more realistic representation of the uncertainties inherent in fish stock assessments, such as environmental variability and observation errors. The key features of the SPiCT model include:
- **Stochasticity**: The model incorporates process and observation errors, allowing for the quantification of uncertainty in biomass estimates and reference points.
- **Continuous-time framework**: Unlike discrete-time models, SPiCT operates in continuous time, providing a more flexible and accurate representation of stock dynamics.
- **Multiple data sources**: SPiCT can integrate various types of data, including catch data, abundance indices from surveys, and fishery-dependent indices such as LPUE and fishing effort.
- **Bayesian inference**: The model employs Bayesian methods for parameter estimation, enabling the incorporation of prior knowledge and the derivation of posterior distributions for model parameters and stock status indicators.

### Data Sources

#### Fishery description

\quad 

Nephrops in FU30 is mainly exploited by a single Spanish bottom otter trawl métier (OTB_MCD >= 55_0_0) and, to a lesser extent, by the Portuguese fleet, operating at depths ranging approximately between 200 and 700 m. The fishery is considered multispecific, targeting a variety of crustaceans, cephalopods and demersal fish, including rose shrimp (*Parapenaeus longirostris*), Nephrops, tiger shrimp, spottail shrimp, octopus, squids, cuttlefish, hake, mullets, sparids, wedge sole, sole and horse mackerel, using a minimum mesh size of 55 mm. Discards are considered negligible.

The increasing abundance of other commercially valuable species in this fishery, particularly rose shrimp (*Parapenaeus longirostris*), is believed to potentially influence fishing behaviour and objectives. Rose shrimp reaches higher market prices and is distributed at shallower depths (approximately 90–380 m) and closer to the coast, making its fishing grounds more accessible.


Landings increased from 1994 to 2003, exceeding 300 t, followed by a sharp decline to 147 t in 2004, representing a reduction of more than 50%. After a temporary recovery in 2005 (246 t), landings declined again to around 120 t in 2008 and stabilised at approximately 100 t until 2012.

During the period 2013–2015, landings decreased dramatically as a result of a penalty imposed by the European Commission for exceeding the TAC in 2012 [@EU2023Reg194]. The Nephrops fishery was closed for most of 2013, and a substantially reduced TAC (25 t per year) was applied during the subsequent three years. In 2016 and 2017, landings increased to 124 and 140 t, respectively, representing nearly a six-fold increase compared to the penalty period. However, in 2018, landings declined by approximately 46% relative to the previous year, marking the onset of a sustained decreasing trend. This decline continued, with landings in 2023 estimated at 32.8 t.

The progressive reduction of the TAC since 2020 may be constraining the fishery, as evidenced by the closure of the Nephrops fishery from 18 September to 4 December 2023 when landings approached the allocated quota, and the subsequent closure following the exhaustion of the 2023 quota, as established by Regulation (EU) 2024/225 [@EU2024Reg225].

Nephrops fishing effort, estimated as the number of trips (fishing days) landing at least 10% Nephrops, shows an increasing trend from 1994 to 2005, when it reached the maximum value of the time series (4 336 fishing days). From 2006 onwards, fishing effort gradually declined, stabilising at approximately 1 500 fishing days until 2012. This reduction in effort was mainly driven by the implementation of successive fishing plans for the Gulf of Cádiz by the Spanish Administration since 2004 (Orders APA/3423/2004, APA/2858/2005, APA/2883/2006, APA/2801/2007, ARM/2515/2009, ARM/58/2010, ARM/2457/2010, AAA/627/2013, AAA/1710/2014, AAA/1406/2016, APM/664/2017 and APM/453/2018).

As a consequence of the sanction imposed in 2012, fishing effort dropped sharply during the period 2013–2015, reaching a mean value of approximately 283 fishing days. Subsequently, fishing effort increased from 2016 (443 fishing days) to 2019 (675 fishing days), remaining relatively stable at around 600 fishing days in 2020 and 2021. However, in 2022 and 2023, Nephrops-directed effort declined again, reaching a mean value of approximately 366 fishing days.

The commercial Nephrops-directed LPUE shows a decreasing trend from 1994 to 2000, followed by fluctuating values for the remainder of the time series. The period 2013–2015 should be interpreted with caution due to the quota overrun penalty imposed in 2012, which increases uncertainty in the LPUE index. In addition, the vessel-level allocation of Nephrops quotas implemented in 2014 may have led to unreported landings, further contributing to uncertainty in the commercial LPUE index. Moreover, since 2016 the commercial LPUE has been estimated using officially reported landings rather than total landings estimated by the Working Group, potentially increasing uncertainty in the index.

Based on the available data analysis and compilation the proposed models for depth-based  fisheries correspond to Tier 3, i.e., models of logistic growth for global population productivity, as described by @Paya2014.

Accordingly, two alternatives are presented to model the population dynamics of *Nephrops norvegicus* in the Gulf of Cádiz, as well as to provide recommendations for resource management.


Annual Nephrops landings in FU30 exhibit marked interannual variability over the analysed period (Figure \@ref(fig:landings)). Catches increased steadily during the late 1990s and early 2000s, reaching peak values in the early 2000s, followed by a sharp decline associated with management measures and quota restrictions. After this period, landings remained at comparatively lower levels, with pronounced fluctuations in recent years. The dashed horizontal line in Figure @ref(fig:landings) represents the long-term mean catch and provides a reference against which periods of above- and below-average exploitation can be identified. Overall, the landings time series reflects both changes in stock availability and the effects of regulatory constraints applied to the fishery.


#### Abundances Index

\quad 

The **ISUNEPCA UWTV survey** (U9111) has been conducted annually in the Gulf of Cádiz (FU30) during spring–summer since 2014, although the first survey is considered exploratory. The survey was not carried out in 2020 due to the COVID-19 pandemic. The survey area used to estimate Nephrops abundance in FU30 was originally defined during the Benchmark Workshop on Nephrops stocks (WKNEP) in 2016 [@Vila2016; @ICES2017WKNEP] and subsequently modified during WGBIE 2022 [@ICES2022WGBIE; @VilaBurgos2022]. The current area over which Nephrops is distributed covers 2 332.13 km².

The survey follows a randomized isometric grid design, with stations spaced at 4 nautical miles from 2015 to 2021 and reduced to 3.5 nautical miles since 2022. Quantification of Nephrops burrows and the geostatistical estimation of abundance are conducted following ICES Cooperative Research standards [@Leocadio2018].

The methodology described in ICES Cooperative Research Report No. 340 [@Leocadio2018] was used to derive biomass estimates from the UWTV survey. Annual Nephrops biomass was obtained by multiplying the yearly abundance estimates by the annual mean individual weight derived from commercial landings. ICES considers this approach the most appropriate method to obtain absolute biomass estimates for Nephrops stocks and recommends the preferential use of UWTV surveys as the basis for scientific advice for Nephrops [@ICES2009WKNEP].

\quad

Two bottom trawl **ARSA surveys**, the spring survey (SpSGFS-cspr-WIBTS-Q1) and the autumn survey (SpGFS-caut-WIBTS-Q4), are conducted annually in the southern part of ICES Division 9.a (Gulf of Cádiz), corresponding to FU30. The survey area covers approximately 7 224 km² and spans depths from 15 to 800 m. The sampling design follows a random stratified scheme with five depth strata: 15–30 m, 31–100 m, 101–200 m, 201–500 m and 501–800 m.

These surveys collect information on the distribution, relative abundance and biological characteristics of commercial demersal species, although they are not specifically designed to estimate Nephrops abundance. Nevertheless, they can be used to analyse temporal trends. The Nephrops survey index is expressed as biomass in the two deepest strata (200–500 m and 501–800 m), as Nephrops is mainly distributed within these depth ranges, which approximately overlap with the ISUNEPCA UWTV survey area. For some years, data for one or both of these strata are unavailable, leading to the exclusion of the biomass index for those years from the analysis.

The ARSA spring survey (SpSGFS-cspr-WIBTS-Q1) is usually conducted from late February to early March, while the ARSA autumn survey (SpGFS-caut-WIBTS-Q4) takes place in November (Figure \@ref(fig:landindex)).

\quad

The **commercial LPUE series** for Nephrops in FU30 has been calculated using landings and effort data from the Spanish and Portuguese fleets operating in the area. Effort is expressed as the number of fishing days, defined as trips landing at least 10% Nephrops. The LPUE is calculated as the ratio of landings (in kg) to fishing effort (in fishing days) for each year (...working progress).

A suite of fishery-independent and fishery-dependent indices was used to characterize the temporal dynamics of the Nephrops FU30 stock (Figure \@ref(fig:indices)). These include survey-based indices derived from ARSA trawl surveys and ISUNEPCA UWTV surveys, as well as commercial indices such as LPUE and effort-related metrics. The indices display contrasting temporal patterns, reflecting differences in survey design, spatial coverage, and the biological processes captured by each data source. While some indices suggest periods of relative stability, others indicate substantial variability over time, particularly in recent years. Smoothed trends highlight medium-term changes and help to distinguish persistent signals from short-term fluctuations. Taken together, these indices provide complementary information on stock abundance and exploitation dynamics and form the empirical basis for the SPiCT model explorations presented in this study.

Pairwise relationships among the different abundance, productivity and fishery-dependent indices were explored using a Spearman rank correlation analysis. Spearman correlations were selected to account for potential non-linear relationships and non-normal distributions in the time series. 

The summary of the input data series used for SPiCT explorations for *Nephrops norvegicus* in Functional Unit 30 is presented in Table \@ref(tab:inputdata). The data sources include:

* **Total catches** (1987–2025).
* **Fishing effort** (1994–2025), expressed as total fishing days.
* **Standardised landings per unit of effort (LPUE)** (1994–2025).
* **ISUNEPCA UWTV survey indices**, including:
  * absolute **abundance index** (available from 2015–2025), and
  * associated **biomass index** (available for selected years).
* **ARSA survey indices**, comprising:
  * **spring survey index** (1993–2025),
  * **autumn survey index** (1998–2025),
  * and derived **productivity indices** used in selected scenarios.

All time series were harmonised temporally and formatted consistently prior to model fitting. Alternative combinations of these data sources were used to define the different SPiCT scenarios explored in this study.

```{=latex}
\begin{landscape}
```

```{r inputdata}
bac <- read_csv(here("data",
                     "inputdata_FU30_wkbmsyspict.csv")) %>%
  mutate(
    Effort = Total_Effort,
    LPUE_std = catch / Effort
  )

bac_tab <- bac %>%
  transmute(
    Year = year,
    CATC = catch,        # Catches
    ARSB = arsabio,      # ARSA biomass index
    ARSP = arsarendi,    # ARSA productivity index
    ARSS = arsa_std_nor, # ARSA standardised index
    ARCV = arsa_CV_std_nor, # ARSA coefficient of variation
    ISUB = isunepbio_nor,   # ISUNEPCA biomass index
    ISUA = isunepabun,      # ISUNEPCA abundance index
    EFRT = Effort,          # Fishing effort (days)
    LPUE = LPUE_std         # Standardised LPUE
  )
kable(
  bac_tab,
  format = "latex",
  booktabs = TRUE,
  longtable = TRUE,
  caption = "Summary of input data series used for SPiCT explorations for *Nephrops norvegicus* in Functional Unit 30. Column abbreviations are as follows: CATC = total catches (t); ARSB = ARSA biomass survey index; 
ARSP = ARSA productivity index; ARSS = standardised ARSA index; ARCV = coefficient of variation of the ARSA index;
ISUB = ISUNEPCA UWTV biomass index; ISUA = ISUNEPCA UWTV abundance index; 
EFRT = fishing effort (days); and LPUE = standardised landings per unit of effort.",
  align = "c"
) %>%
  kable_styling(
    latex_options = c("repeat_header", "scale_down", "compress"),
    font_size = 10
  ) 

```

```{=latex}
\end{landscape}
```




### Neprhops FU30 Scenarios

\quad

Several SPiCT model configurations were explored for Nephrops FU30, varying in the inclusion of abundance indices, catch data, and model parameterisations (priors). This exploratory framework is consistent with the approach adopted in previous ICES Nephrops working groups, where alternative data configurations and prior assumptions have been systematically tested to evaluate model robustness and suitability for assessment purposes. The full set of SPiCT model configurations explored in this study is summarised in Table \@ref(tab:scenarios), including the input data used in each scenario and the corresponding prior configurations applied consistently across scenarios. This structured exploration allows for a transparent comparison of model behaviour and performance, in line with recent methodological developments discussed within ICES Nephrops expert groups.

The `Scenario 0` included catch data from 1994 to 2023 and the ISUNEPCA UWTV survey index from 2015 to 2023, reflecting the core data sources currently used in the assessment framework for this stock. Additional scenarios were developed to assess the effect of incorporating supplementary fishery-independent and fishery-dependent information, such as the ARSA survey index (`Scenario 2`), as well as alternative indicators derived from effort and LPUE series. Further scenarios explored the sensitivity of model outcomes to different assumptions regarding process error, observation error, and prior distributions for key biological parameters, following configurations commonly examined in recent Nephrops assessments (`Scenarios 3–5`).


Explorations were conducted using data available up to 2025. Tables below summarise the different scenarios and model configurations tested. Fishing effort and LPUE were not included in any scenario, as survey-based indices are recommended when available. The autumn ARSA survey (SpGFS-caut-WIBTS-Q4) was also excluded from the analyses, as part of the stock is not accessible to the gear during this survey due to the reproductive behaviour of Nephrops. In November, ovigerous females remain inside their burrows and are therefore unavailable to bottom trawl sampling. For this reason, the autumn ARSA survey index has never been included in the FU30 WGBIE assessments.

The ISUNEPCA UWTV survey index is considered the most reliable abundance index for Nephrops in FU30 and is currently used as the basis for assessment and advice [@ICES2023b]. This survey is conducted in the year of the assessment; for example, the UWTV survey planned for June 2024 will be used to inform the advice for 2025, delivered in October 2024. If the 2024 ISUNEPCA index were to be included in a SPiCT model, catch data for 2024 would not yet be available. This issue should be explicitly addressed if SPiCT is adopted as the assessment model for this stock in a future benchmark.



```{r scenarios}
scenarios_df <- data.frame(
  Scenario = c(
    "SC0",
    "SC1",
    "SC2",
    "SC3",
    "SC4",
    "SC5"
  ),

  Input_Data = c(
    "Catches; ISUNEPCA UWTV abundance index",
    "Catches; ISUNEPCA UWTV abundance; ARSA spring survey",
    "Catches; ISUNEPCA UWTV abundance; Directed commercial LPUE",
    "Catches; ISUNEPCA UWTV abundance; Directed fishing effort",
    "Catches; ISUNEPCA UWTV abundance; Standardized LPUE",
    "Catches; ARSA spring; ARSA autumn; ISUNEPCA biomass; ISUNEPCA abundance; ARSA productivity; Commercial LPUE"
  ),

  Time_Span = c(
    "1994–2025",
    "1994–2025",
    "1994–2025",
    "1994–2025",
    "1994–2025",
    "1994–2025"
  ),

  Description = c(
    "Baseline configuration using only the UWTV survey as absolute abundance index.",
    "Configuration combining UWTV and ARSA spring surveys to assess consistency between fishery-independent indices.",
    "Configuration including fishery-dependent information through directed LPUE.",
    "Configuration using directed fishing effort as a proxy of stock dynamics.",
    "Configuration testing the use of standardized LPUE instead of raw commercial indices.",
    "Full configuration including all available survey and fishery-dependent indices to explore model behaviour under maximum data availability."
  ),

  stringsAsFactors = FALSE
)
scenarios_tab <- scenarios_df %>%
  rename(
    "Scenario" = Scenario,
    "Input data" = Input_Data,
    "Time span" = Time_Span,
    "Methodological description" = Description
  )
kable(
  scenarios_tab,
  format = "latex",
  booktabs = TRUE,
  longtable = TRUE,
  caption = paste(
    "Summary of SPiCT model configurations (scenarios) explored for",
    "\\textit{Nephrops norvegicus} in Functional Unit 30.",
    "All scenarios were tested under four alternative prior configurations (RUN1–RUN4)."
  ),
  align = c("l", "p{4.5cm}", "c", "p{7cm}")
) %>%
  kable_styling(
    latex_options = c("repeat_header", "scale_down"),
    font_size = 8
  )
```

\newpage

### New Scenarios in Nephrops FU30 explorations

To extend the SPiCT-based assessment of *Nephrops*, we defined **three additional modelling scenarios (Scenarios 6–8)** that incorporate alternative combinations of fishery-dependent and fishery-independent information (Table \@ref(tab:newscenario)). All scenarios include total landings as the catch time series and differ in the configuration of abundance indices (Figure \@ref(fig:indices)). `Scenario 6` combines landings with normalized ISUNEPCA biomass and normalized ARSA biomass indices. `Scenario 7` integrates landings with normalized ISUNEPCA biomass and a standardized LPUE index. `Scenario 8` represents the most information-rich configuration, combining landings with normalized ISUNEPCA biomass, normalized ARSA biomass, and standardized LPUE. 

```{r newscenario}
scenarios_df1 <- data.frame(
  Scenario = c(
    "SC6",
    "SC7",
    "SC8"
  ),

  Input_Data = c(
    "Catches; ISUNEPCA UWTV biomass (normalized); ARSA biomass (normalized)",
    "Catches; ISUNEPCA UWTV biomass (normalized); Standardised LPUE",
    "Catches; ISUNEPCA UWTV biomass (normalized); ARSA biomass (normalized); Standardised LPUE"
  ),

  Time_Span = c(
    "1994–2025",
    "1994–2025",
    "1994–2025"
  ),

  Description = c(
    "Scenario combining total landings with normalized ISUNEPCA UWTV biomass and normalized ARSA biomass indices, representing a configuration based exclusively on fishery-independent information.",
    "Scenario integrating total landings with normalized ISUNEPCA UWTV biomass and a standardized LPUE index, combining fishery-independent and fishery-dependent information.",
    "Most information-rich configuration, combining total landings with normalized ISUNEPCA UWTV biomass, normalized ARSA biomass, and standardized LPUE indices to explore model behaviour under maximum data availability."
  ),

  stringsAsFactors = FALSE
)
scenarios_tab1 <- scenarios_df1 %>%
  rename(
    "Scenario" = Scenario,
    "Input data" = Input_Data,
    "Time span" = Time_Span,
    "Methodological description" = Description
  )
kable(
  scenarios_tab1,
  format = "latex",
  booktabs = TRUE,
  longtable = TRUE,
  caption = paste(
    "Extended SPiCT model configurations (Scenarios 6–8) explored for",
    "\\textit{Nephrops norvegicus} in Functional Unit 30.",
    "All scenarios were fitted using the same four alternative prior configurations (RUN1–RUN4)."
  ),
  align = c("l", "p{5cm}", "c", "p{7cm}")
) %>%
  kable_styling(
    latex_options = c("repeat_header", "scale_down"),
    font_size = 8
  )
```

Across all SPiCT scenarios, four alternative prior configurations (RUN1–RUN4) were explored to evaluate model sensitivity to assumptions on stock depletion, production curve shape, and intrinsic population growth. The baseline run (RUN1) relied on default SPiCT priors, while subsequent configurations progressively introduced informative priors on initial depletion (B/K), the production curve shape parameter (n), and the intrinsic growth rate (r). This hierarchical design ensured consistent and comparable evaluation of prior influence across scenarios (Table \@ref(tab:spictpriors)).


```{r spictpriors}
priors_df <- data.frame(
  Run = c(
    "RUN1",
    "RUN2",
    "RUN3",
    "RUN4"
  ),

  Prior_Configuration = c(
    "Default (package defaults)",
    "logbkfrac",
    "logbkfrac, logn",
    "logbkfrac, logn, logr"
  ),

  Specification = c(
    "Default SPiCT priors",
    "logbkfrac ~ log(0.5), SD = 0.2",
    "logbkfrac ~ log(0.5), SD = 0.2; logn ~ log(2), SD = 0.5",
    "logbkfrac ~ log(0.5), SD = 0.2; logn ~ log(2), SD = 0.5; logr ~ log(0.2), SD = 0.2"
  ),

  Purpose = c(
    "Baseline configuration using default SPiCT assumptions.",
    "Constrains initial depletion (B/K) around an intermediate level with low uncertainty.",
    "Adds a tighter prior on the production curve shape parameter (n).",
    "Fully informative configuration including priors on depletion, production curve shape and intrinsic growth rate."
  ),

  stringsAsFactors = FALSE
)
priors_tab <- priors_df %>%
  rename(
    "Run" = Run,
    "Prior configuration" = Prior_Configuration,
    "Specification" = Specification,
    "Purpose" = Purpose
  )

kable(
  priors_tab,
  format = "latex",
  booktabs = TRUE,
  longtable = TRUE,
  caption = paste(
    "Summary of prior configurations (RUNs) explored for the SPiCT model",
    "applied to \\textit{Nephrops norvegicus} in Functional Unit 30."
  ),
  align = c("c", "p{3cm}", "p{5cm}", "p{6cm}")
) %>%
  kable_styling(
    latex_options = c("repeat_header", "scale_down"),
    font_size = 8
  )
```


To ensure consistency and comparability across scenarios, all new configurations are fitted using the same set of four prior specifications previously defined in the analysis. Results will be presented comparatively across scenarios, including diagnostic plots, key stock status outputs, and management-related figures and summary tables, allowing a coherent evaluation of model behaviour and management implications under alternative data combinations. A total of 36 SPiCT model runs were conducted, corresponding to four alternative prior configurations (RUN1–RUN4) applied consistently across nine model scenarios (SC0–SC8). This factorial design allowed for the evaluation of model behaviour, convergence and sensitivity to both data configuration and prior assumptions on key biological and production parameters.

\newpage

## Results

### Previous Analysis


The exploratory modelling scenarios SC0 to SC5 implemented in the present analysis are documented in detail in the technical report by @VilaQuinzan2024, where alternative configurations of fishery-dependent and fishery-independent data were systematically evaluated using the SPiCT framework for *Nephrops norvegicus* in Functional Unit 30. These scenarios form part of the broader exploratory analyses conducted to assess model behaviour, data sensitivity, and the robustness of stock status estimates under different information assumptions.


In the new explorations, in this report we focus on the results obtained from the additional scenarios (`SC6` to `SC8`) that incorporate alternative combinations of abundance indices and fishery-dependent information. The following sections present a synthesis of the key findings from these new scenarios, including diagnostic evaluations, stock dynamics, and management implications, while also referencing relevant results from the previously documented scenarios (`SC0` to `SC5`) for comparative purposes.

#### Correlation analysis of input data series

The Figure \@ref(fig:correlation) reveals strong positive correlations among indices derived from similar sources, particularly between ISUNEPCA UWTV biomass and abundance indices, as well as between standardized LPUE and effort-related metrics. In contrast, ARSA-based indices show weaker or negative correlations with some fishery-dependent indicators, highlighting differences in spatial coverage and survey design. Overall, the results indicate a clear clustering of indices by data origin, suggesting partial redundancy among some series and complementarity across others.

### Hindcast Analysis

The Mean Absolute Scaled Error (MASE) is a widely used metric for evaluating the predictive accuracy of time series models. It is defined as the mean absolute error of the model's predictions, scaled by the mean absolute error of a naive forecast (typically the previous observation). MASE values below 1 indicate that the model outperforms the naive forecast, while values above 1 suggest inferior performance.

Hindcast diagnostics by scenario and prior configuration are presented in Figures
\@ref(fig:hindcastsc0run4) and \@ref(fig:hindcastsc1run1)–\@ref(fig:hindcastsc2run4), illustrating model predictive performance under alternative data and prior combinations.


### Retrospective Analysis

Retrospective patterns for each modelling scenario were evaluated under alternative prior configurations.
Scenario-specific diagnostics are shown in Figures \@ref(fig:retroSC0RUN4)–\@ref(fig:retroSC5RUN4),
illustrating the temporal stability of biomass and fishing mortality estimates across successive peelings. Retrospective bias was evaluated using Mohn’s rho estimates (Table \@ref(tab:mohnsrho)).




The results indicate that all model runs achieved MASE values below 1, demonstrating that the SPiCT model consistently outperformed the naive forecast in predicting stock dynamics. Notably, RUN3 exhibited the lowest MASE value, suggesting that the inclusion of informative priors on both initial depletion and production curve shape enhanced model predictive accuracy. These findings underscore the importance of prior specification in improving model performance and provide confidence in the SPiCT model's ability to capture key stock dynamics for Nephrops FU30.



### Comparative Population variables

Scenario-specific stock dynamics derived from the SPiCT model are illustrated through estimated biomass
(Figures \@ref(figBiomassSC0)–\@ref(figBiomassSC5)) and fishing mortality trajectories
(Figures \@ref(figFishingMortalitySC0)–\@ref(figFishingMortalitySC5)), allowing direct comparison of model behaviour across alternative data configurations.


### Management Outputs


Management strategy evaluation results by scenario are summarised in Table \@ref(tab:managementsummary). Values correspond to equilibrium projections for relative biomass (B/Bmsy), fishing mortality (F/Fmsy), and expected catches under each management rule.


> CHECK!!! Key reference points, including MSY, BMSY, FMSY, and current stock status indicators (B/BMSY and F/FMSY), are presented alongside uncertainty estimates (95% credible intervals). The results indicate that all scenarios suggest the stock is currently below BMSY, with varying degrees of fishing pressure relative to FMSY. Notably, Scenario 2 under RUN4 configuration indicates the most optimistic stock status, with B/BMSY approaching 1 and F/FMSY below 1, suggesting potential for recovery under current management measures. In contrast, Scenario 0 under RUN1 configuration indicates a more depleted stock status, with B/BMSY significantly below 1 and F/FMSY exceeding 1, highlighting the need for continued management interventions. Overall, the results underscore the sensitivity of stock status estimates to both data configuration and prior assumptions, emphasizing the importance of robust model selection in fisheries management.

\newpage

## Conclusions

WGBIE considered the results obtained for Nephrops FU 30 stock promising and will propose it as possible candidate for the next WKMSYSPiCT benchmark. However, further work should be conducted to improve the model according to the most recent SPiCT guidelines [@Mildenberger2023SPiCT]. The WKMSYSPiCT benchmark, where a close contact with SPiCT expert is possible, could help to find the best model configuration to provide the assessment for this stock.
Further work is needed to improve the model, including:
 
- Extend the time series of landings to earlier years in order to improve the stability and robustness of the model
- Add uncertainty in some years of the biomass indices time series or catches
- Fine-tune model configuration.

\newpage

## Code Repositories

All this work has been developed using R language. The code and data used for the SPiCT explorations for Nephrops FU30 can be found in the following GitHub repository:

All updates and improvements can be followed and obtained at the [SPiCT GitHub repository](https://github.com/DTUAqua/spict/commits/master). Bugs and issues can be reported via the [SPiCT Releases page](https://github.com/DTUAqua/spict/releases).

Nephrops Stock Assessment and Exploratory Data Analysis (ICES Division 9A) codes to replicate  part of this analysis, is available at the following GitHub repository:
[Nephros SPiCT codes](https://github.com/MauroMardones/Nephrops_SA)


\newpage

## Figures and Tables

```{r areaconcept, out.width='70%', fig.cap="Map of the Gulf of Cádiz (FU30, Division 9.a) showing the main fishing grounds for Nephrops norvegicus."}
knitr::include_graphics("../figs/studyarea.png")
```


```{r landings, out.width='100%', fig.cap="Time series of annual Nephrops landings (tons) for FU30 (Division 9.a). Bars represent reported annual catches, while the dashed horizontal line indicates the long-term mean catch over the period analysed."}
knitr::include_graphics("../figs/landings_nephrops_FU30.png")
```


```{=latex}
\begin{landscape}
```

```{r indices, out.width='100%', fig.cap="Time series of abundance and fishery-dependent indices used in the SPiCT explorations for Nephrops FU30 (Division 9.a). Panels A–H show the different survey-based and commercial indices. Points represent observed annual values, while solid lines correspond to smoothed trends with associated uncertainty envelopes."}
knitr::include_graphics("../figs/indices_nephrops_FU30_all.png")
```

```{=latex}
\end{landscape}
```


```{r correlation, out.width='100%', fig.cap="Spearman rank correlation heatmap among abundance, productivity and fishery-dependent indices for Nephrops FU30 (Division 9.a). Colours indicate the strength and direction of correlations (red: positive; blue: negative), and hierarchical clustering highlights groups of highly correlated indices."}
knitr::include_graphics("../figs/correlation_pearson_nephrops_FU30.png")
```


```{r surplusplot, out.width='70%', fig.cap="Comparison of surplus production functions: Schaefer (n=1), Pella - Tomlinson (n=2) and Fox (log)."}

# Parámetros comunes
r <- 1
K <- 1
B <- seq(0.001, K, length.out = 200)  # evita log(0) en Fox
# Parámetro de Pella–Tomlinson
n_pella <- 2

# Funciones de producción
P_schaefer <- r * B * (1 - B / K)             # n = 1 (Schaefer)
P_pella    <- r * B * (1 - (B / K)^n_pella)   # n = 2 (Pella–Tomlinson)
P_fox      <- r * B * log(K / B)              # Fox

# Crear dataframe para graficar
df <- data.frame(
  B = rep(B, 3),
  Production = c(P_schaefer, P_pella, P_fox),
  Model = factor(rep(c("Schaefer (n=1)",
                       "Pella - Tomlinson (n = 2)",
                       "Fox (log)"), each = length(B)))
)

# Graficar
surplusplot <- ggplot(df, aes(x = B/K, y = Production, color = Model)) +
  geom_line(size = 1.2) +
  theme_bw(base_size = 14) +
  labs(
    x = "Relative Biomass (B/K)",
    y = "Relative Production (Y/K)",
    title = ""
  ) +
  scale_color_manual(values = c("blue", "red", "darkgreen")) +
  theme(
    legend.position = "top",
    legend.title = element_blank()
  )
surplusplot 
```



```{r hindcastsc0run4, fig.cap="Hindcast diagnostics for Scenario SC0 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC0_RUN4.png")
```

```{r hindcastsc1run1, fig.cap="Hindcast diagnostics for Scenario SC1 under prior configuration RUN1.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC1_RUN1.png")
```

```{r hindcastsc1run2, fig.cap="Hindcast diagnostics for Scenario SC1 under prior configuration RUN2.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC1_RUN2.png")
```

```{r hindcastsc1run3, fig.cap="Hindcast diagnostics for Scenario SC1 under prior configuration RUN3.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC1_RUN3.png")
```

```{r hindcastsc1run4, fig.cap="Hindcast diagnostics for Scenario SC1 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC1_RUN4.png")
```

```{r hindcastsc2run1, fig.cap="Hindcast diagnostics for Scenario SC2 under prior configuration RUN1.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC2_RUN1.png")
```


```{r hindcastsc2run2, fig.cap="Hindcast diagnostics for Scenario SC2 under prior configuration RUN2.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC2_RUN2.png")
```

```{r hindcastsc2run3, fig.cap="Hindcast diagnostics for Scenario SC2 under prior configuration RUN3.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC2_RUN3.png")
```


```{r hindcastsc2run4, fig.cap="Hindcast diagnostics for Scenario SC2 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/hindcast/hindcast_SC2_RUN4.png")
```


```{r retroSC0RUN4, fig.cap="Retrospective analysis diagnostics for Scenario SC0 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC0_RUN4.png")
```


```{r retroSC1RUN1, fig.cap="Retrospective analysis diagnostics for Scenario SC1 under prior configuration RUN1.",      out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC1_RUN1.png")
```
```{r retroSC1RUN2, fig.cap="Retrospective analysis diagnostics for Scenario SC1 under prior configuration RUN2.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC1_RUN2.png")
```

```{r retroSC1RUN3, fig.cap="Retrospective analysis diagnostics for Scenario SC1 under prior configuration RUN3.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC1_RUN3.png")
```

```{r retroSC1RUN4, fig.cap="Retrospective analysis diagnostics for Scenario SC1 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC1_RUN4.png")
```


```{r retroSC2RUN1, fig.cap="Retrospective analysis diagnostics for Scenario SC2 under prior configuration RUN1.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC2_RUN1.png")
```

```{r retroSC2RUN2, fig.cap="Retrospective analysis diagnostics for Scenario SC2 under prior configuration RUN2.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC2_RUN2.png")
```

```{r retroSC2RUN3, fig.cap="Retrospective analysis diagnostics for Scenario SC2 under prior configuration RUN3.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC2_RUN3.png")
```

```{r retroSC2RUN4, fig.cap="Retrospective analysis diagnostics for Scenario SC2 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC2_RUN4.png")
```

```{r retroSC3RUN4, fig.cap="Retrospective analysis diagnostics for Scenario SC3 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC3_RUN4.png")
```

```{r retroSC4RUN1, fig.cap="Retrospective analysis diagnostics for Scenario SC4 under prior configuration RUN1.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC4_RUN1.png")
```

```{r retroSC4RUN2, fig.cap="Retrospective analysis diagnostics for Scenario SC4 under prior configuration RUN2.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC4_RUN2.png")
```

```{r retroSC4RUN3, fig.cap="Retrospective analysis diagnostics for Scenario SC4 under prior configuration RUN3.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC4_RUN3.png")
```

```{r retroSC4RUN4, fig.cap="Retrospective analysis diagnostics for Scenario SC4 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC4_RUN4.png")
```


```{r retroSC5RUN1, fig.cap="Retrospective analysis diagnostics for Scenario SC5 under prior configuration RUN1.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC5_RUN1.png")
```

```{r retroSC5RUN2, fig.cap="Retrospective analysis diagnostics for Scenario SC5 under prior configuration RUN2.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC5_RUN2.png")
```

```{r retroSC5RUN3, fig.cap="Retrospective analysis diagnostics for Scenario SC5 under prior configuration RUN3.",  out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC5_RUN3.png")
```

```{r retroSC5RUN4, fig.cap="Retrospective analysis diagnostics for Scenario SC5 under prior configuration RUN4.", out.width="\\textwidth"}
knitr::include_graphics("../figs/retro/RETRO_SC5_RUN4.png")
```

```{r mohnsrho, results='asis'}
mohns_rho_by_scenario <- read_csv(here("outputs",
                                       "retro",
                                       "mohns_rho_by_scenario.csv"))
mohn_tab <- mohns_rho_by_scenario %>%
  mutate(
    across(
      c(Mohn_BBmsy, Mohn_FFmsy),
      ~ round(.x, 2)
    )
  )

kable(
  mohn_tab,
  format = "latex",
  booktabs = TRUE,
  longtable = TRUE,
  caption = paste(
    "Mohn’s rho estimates derived from retrospective analyses of the SPiCT models",
    "for \\textit{Nephrops norvegicus} in Functional Unit 30.",
    "Values are reported for relative spawning biomass (B/B\\textsubscript{MSY})",
    "and fishing mortality (F/F\\textsubscript{MSY}) by scenario and prior configuration (RUN)."
  ),
  align = c("l", "l", "c", "c")
) %>%
  kable_styling(
    latex_options = c("repeat_header", "scale_down"),
    font_size = 8
  )
```


```{r figBiomassSC0,  fig.cap="Estimated relative biomass trajectory for Scenario SC0 derived from the SPiCT model.",       out.width="\\textwidth"}
knitr::include_graphics("../figs/Biomass_SC0.png")
```

```{r figBiomassSC1, fig.cap="Estimated relative biomass trajectory for Scenario SC1 derived from the SPiCT model.",       out.width="\\textwidth"}
knitr::include_graphics("../figs/Biomass_SC1.png")
```

```{r figBiomassSC2, fig.cap="Estimated relative biomass trajectory for Scenario SC2 derived from the SPiCT model.",       out.width="\\textwidth"}
knitr::include_graphics("../figs/Biomass_SC2.png")
```

```{r figBiomassSC3, fig.cap="Estimated relative biomass trajectory for Scenario SC3 derived from the SPiCT model.", out.width="\\textwidth"}
knitr::include_graphics("../figs/Biomass_SC3.png")
```

```{r figBiomassSC4, fig.cap="Estimated relative biomass trajectory for Scenario SC4 derived from the SPiCT model.",       out.width="\\textwidth"}
knitr::include_graphics("../figs/Biomass_SC4.png")
```

```{r figBiomassSC5, fig.cap="Estimated relative biomass trajectory for Scenario SC5 derived from the SPiCT model.", out.width="\\textwidth"}
knitr::include_graphics("../figs/Biomass_SC5.png")
```

```{r figFishingMortalitySC0, fig.cap="Estimated fishing mortality trajectory for Scenario SC0 derived from the SPiCT model.", out.width="\\textwidth"}
knitr::include_graphics("../figs/FishingMortality_SC0.png")
```

```{r figFishingMortalitySC1, fig.cap="Estimated fishing mortality trajectory for Scenario SC1 derived from the SPiCT model.", out.width="\\textwidth"}
knitr::include_graphics("../figs/FishingMortality_SC1.png")
```

```{r figFishingMortalitySC2, fig.cap="Estimated fishing mortality trajectory for Scenario SC2 derived from the SPiCT model.",       out.width="\\textwidth"}
knitr::include_graphics("../figs/FishingMortality_SC2.png")
```

```{r figFishingMortalitySC3, fig.cap="Estimated fishing mortality trajectory for Scenario SC3 derived from the SPiCT model.",      out.width="\\textwidth"}
knitr::include_graphics("../figs/FishingMortality_SC3.png")
```

```{r figFishingMortalitySC4, fig.cap="Estimated fishing mortality trajectory for Scenario SC4 derived from the SPiCT model.", out.width="\\textwidth"}
knitr::include_graphics("../figs/FishingMortality_SC4.png")
```

```{r figFishingMortalitySC5, fig.cap="Estimated fishing mortality trajectory for Scenario SC5 derived from the SPiCT model.",    out.width="\\textwidth"}
knitr::include_graphics("../figs/FishingMortality_SC5.png")
```


```{r managementsummary, results='asis'}
manage_summary_all_scenarios_runs <- readr::read_csv(
  here("outputs", "manage_summary_all_scenarios_runs.csv")
)

manage_tab <- manage_summary_all_scenarios_runs %>%
  mutate(
    est.C = round(est.C, 2),
    est.B.Bmsy = round(est.B.Bmsy, 2),
    est.F.Fmsy = round(est.F.Fmsy, 2)
  ) %>%
  arrange(scenario, run, Management_rule) %>%
  select(
    Scenario = scenario,
    Run = run,
    Management_rule,
    Catch = est.C,
    `B/Bmsy` = est.B.Bmsy,
    `F/Fmsy` = est.F.Fmsy
  )

# Crear tabla base SIN Scenario / Run como columnas visibles
kbl <- kable(
  manage_tab %>% select(-Scenario, -Run),
  format = "latex",
  booktabs = TRUE,
  longtable = TRUE,
  caption = paste(
    "Projected stock status and catch outcomes under alternative management rules",
    "by scenario and prior configuration (RUN) for the SPiCT-based Nephrops FU30 assessment."
  ),
  align = c("p{6cm}", "c", "c", "c")
) %>%
  kable_styling(
    latex_options = c("repeat_header", "scale_down"),
    font_size = 8
  )

# Definir bloques jerárquicos Scenario → RUN
group_sizes <- manage_tab %>%
  count(Scenario, Run)

row_start <- 1
for (i in seq_len(nrow(group_sizes))) {
  row_end <- row_start + group_sizes$n[i] - 1

  kbl <- kbl %>%
    group_rows(
      group_label = paste(
        "Scenario", group_sizes$Scenario[i],
        "–", group_sizes$Run[i]
      ),
      start_row = row_start,
      end_row = row_end,
      bold = TRUE
    )

  row_start <- row_end + 1
}

kbl
```


```{=latex}
\begin{landscape}
```

```{r spictsumm}
summary_table <- read_csv(here("outputs", 
                               "SPiCT_summary_table_all_scenarios_runs.csv")) %>% 
  mutate(
    across(
      where(is.numeric),
      ~ round(.x, 2)
    )
  )



kable(
  summary_table,
  format = "latex",
  booktabs = TRUE,
  longtable = TRUE,
  caption = "Summary of SPiCT model diagnostics and outputs by scenario and prior configuration (RUN).",
  align = "l"
) %>%
  kable_styling(
    latex_options = c("repeat_header", "scale_down"),
    font_size = 8
  ) 


```

```{=latex}
\end{landscape}
```

\newpage

## References
